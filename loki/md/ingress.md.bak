
ingester.zoneAwareReplication object Enabling zone awareness on ingesters will create 3 statefulests where all writes will send a replica to each zone. This is primarily intended to accelerate rollout operations by allowing for multiple ingesters within a single zone to be shutdown and restart simultaneously (the remaining 2 zones will be guaranteed to have at least one copy of the data). Note: This can be used to run Loki over multiple cloud provider availability zones however this is not currently recommended as Loki is not optimized for this and cross zone network traffic costs can become extremely high extremely quickly. Even with zone awareness enabled, it is recommended to run Loki in a single availability zone.

{
  "enabled": true,
  "maxUnavailablePct": 33,
  "migration": {
    "enabled": false,
    "excludeDefaultZone": false,
    "readPath": false,
    "writePath": false
  },
  "zoneA": {
    "annotations": {},
    "extraAffinity": {},
    "nodeSelector": null,
    "podAnnotations": {}
  },
  "zoneB": {
    "annotations": {},
    "extraAffinity": {},
    "nodeSelector": null,
    "podAnnotations": {}
  },
  "zoneC": {
    "annotations": {},
    "extraAffinity": {},
    "nodeSelector": null,
    "podAnnotations": {}
  }
}

ingester.zoneAwareReplication.enabled bool Enable zone awareness.

true

ingester.zoneAwareReplication.maxUnavailablePct int The percent of replicas in each zone that will be restarted at once. In a value of 0-100

33

ingester.zoneAwareReplication.migration object The migration block allows migrating non zone aware ingesters to zone aware ingesters.

{
  "enabled": false,
  "excludeDefaultZone": false,
  "readPath": false,
  "writePath": false
}

ingester.zoneAwareReplication.zoneA object zoneA configuration

{
  "annotations": {},
  "extraAffinity": {},
  "nodeSelector": null,
  "podAnnotations": {}
}

ingester.zoneAwareReplication.zoneA.annotations object Specific annotations to add to zone A statefulset

{}

ingester.zoneAwareReplication.zoneA.extraAffinity object optionally define extra affinity rules, by default different zones are not allowed to schedule on the same host The value will be passed through tpl.

{}

ingester.zoneAwareReplication.zoneA.nodeSelector string optionally define a node selector for this zone

null

ingester.zoneAwareReplication.zoneA.podAnnotations object Specific annotations to add to zone A pods

{}

ingester.zoneAwareReplication.zoneB.annotations object Specific annotations to add to zone B statefulset

{}

ingester.zoneAwareReplication.zoneB.extraAffinity object optionally define extra affinity rules, by default different zones are not allowed to schedule on the same host The value will be passed through tpl.

{}

ingester.zoneAwareReplication.zoneB.nodeSelector string optionally define a node selector for this zone

null

ingester.zoneAwareReplication.zoneB.podAnnotations object Specific annotations to add to zone B pods

{}

ingester.zoneAwareReplication.zoneC.annotations object Specific annotations to add to zone C statefulset

{}

ingester.zoneAwareReplication.zoneC.extraAffinity object optionally define extra affinity rules, by default different zones are not allowed to schedule on the same host The value will be passed through tpl.

{}

ingester.zoneAwareReplication.zoneC.nodeSelector string optionally define a node selector for this zone

null

ingester.zoneAwareReplication.zoneC.podAnnotations object Specific annotations to add to zone C pods

{}

ingress object Ingress configuration Use either this ingress or the gateway, but not both at once. If you enable this, make sure to disable the gateway. You'll need to supply authn configuration for your ingress controller.

{
  "annotations": {},
  "enabled": false,
  "hosts": [
    "loki.example.com"
  ],
  "ingressClassName": "",
  "labels": {},
  "paths": {
    "compactor": [
      "/loki/api/v1/delete"
    ],
    "distributor": [
      "/api/prom/push",
      "/loki/api/v1/push",
      "/otlp/v1/logs",
      "/ui"
    ],
    "queryFrontend": [
      "/api/prom/query",
      "/api/prom/label",
      "/api/prom/series",
      "/api/prom/tail",
      "/loki/api/v1/query",
      "/loki/api/v1/query_range",
      "/loki/api/v1/tail",
      "/loki/api/v1/label",
      "/loki/api/v1/labels",
      "/loki/api/v1/series",
      "/loki/api/v1/index/stats",
      "/loki/api/v1/index/volume",
      "/loki/api/v1/index/volume_range",
      "/loki/api/v1/format_query",
      "/loki/api/v1/detected_field",
      "/loki/api/v1/detected_fields",
      "/loki/api/v1/detected_labels",
      "/loki/api/v1/patterns"
    ],
    "ruler": [
      "/api/prom/rules",
      "/api/prom/api/v1/rules",
      "/api/prom/api/v1/alerts",
      "/loki/api/v1/rules",
      "/prometheus/api/v1/rules",
      "/prometheus/api/v1/alerts"
    ]
  },
  "tls": []
}

ingress.hosts list Hosts configuration for the ingress, passed through the `tpl` function to allow templating

[
  "loki.example.com"
]

ingress.paths.compactor list Paths that are exposed by Loki Compactor. If deployment mode is Distributed, the requests are forwarded to the service: `{{"loki.compactorFullname"}}`. If deployment mode is SimpleScalable, the requests are forwarded to k8s service: `{{"loki.backendFullname"}}`. If deployment mode is SingleBinary, the requests are forwarded to the central/single k8s service: `{{"loki.singleBinaryFullname"}}`

[
  "/loki/api/v1/delete"
]

ingress.paths.distributor list Paths that are exposed by Loki Distributor. If deployment mode is Distributed, the requests are forwarded to the service: `{{"loki.distributorFullname"}}`. If deployment mode is SimpleScalable, the requests are forwarded to write k8s service: `{{"loki.writeFullname"}}`. If deployment mode is SingleBinary, the requests are forwarded to the central/single k8s service: `{{"loki.singleBinaryFullname"}}`

[
  "/api/prom/push",
  "/loki/api/v1/push",
  "/otlp/v1/logs",
  "/ui"
]

ingress.paths.queryFrontend list Paths that are exposed by Loki Query Frontend. If deployment mode is Distributed, the requests are forwarded to the service: `{{"loki.queryFrontendFullname"}}`. If deployment mode is SimpleScalable, the requests are forwarded to write k8s service: `{{"loki.readFullname"}}`. If deployment mode is SingleBinary, the requests are forwarded to the central/single k8s service: `{{"loki.singleBinaryFullname"}}`

[
  "/api/prom/query",
  "/api/prom/label",
  "/api/prom/series",
  "/api/prom/tail",
  "/loki/api/v1/query",
  "/loki/api/v1/query_range",
  "/loki/api/v1/tail",
  "/loki/api/v1/label",
  "/loki/api/v1/labels",
  "/loki/api/v1/series",
  "/loki/api/v1/index/stats",
  "/loki/api/v1/index/volume",
  "/loki/api/v1/index/volume_range",
  "/loki/api/v1/format_query",
  "/loki/api/v1/detected_field",
  "/loki/api/v1/detected_fields",
  "/loki/api/v1/detected_labels",
  "/loki/api/v1/patterns"
]

ingress.paths.ruler list Paths that are exposed by Loki Ruler. If deployment mode is Distributed, the requests are forwarded to the service: `{{"loki.rulerFullname"}}`. If deployment mode is SimpleScalable, the requests are forwarded to k8s service: `{{"loki.backendFullname"}}`. If deployment mode is SimpleScalable but `read.legacyReadTarget` is `true`, the requests are forwarded to k8s service: `{{"loki.readFullname"}}`. If deployment mode is SingleBinary, the requests are forwarded to the central/single k8s service: `{{"loki.singleBinaryFullname"}}`

[
  "/api/prom/rules",
  "/api/prom/api/v1/rules",
  "/api/prom/api/v1/alerts",
  "/loki/api/v1/rules",
  "/prometheus/api/v1/rules",
  "/prometheus/api/v1/alerts"
]

ingress.tls list TLS configuration for the ingress. Hosts passed through the `tpl` function to allow templating

[]
